{% extends "base.html" %}
{% block content %}

<div style="max-width: 1200px; margin: 0 auto; padding: 20px;">

    <div style="text-align: center; margin-bottom: 40px;">
        <h1 class="page-title">ğŸ“Š Financial History</h1>
        <p class="page-subtitle">Track and analyze your farm's financial performance</p>
    </div>

    <!-- Financial Summary -->
    <div class="finance-summary">
        <div class="summary-card income">
            <div class="summary-icon">ğŸ’°</div>
            <div class="summary-value">â‚¹{{ "%.2f"|format(total_income) }}</div>
            <div class="summary-label">Total Income</div>
        </div>

        <div class="summary-card expense">
            <div class="summary-icon">ğŸ’¸</div>
            <div class="summary-value">â‚¹{{ "%.2f"|format(total_expense) }}</div>
            <div class="summary-label">Total Expenses</div>
        </div>

        <div class="summary-card balance">
            <div class="summary-icon">ğŸ“Š</div>
            <div class="summary-value {% if balance >= 0 %}positive{% else %}negative{% endif %}">
                â‚¹{{ "%.2f"|format(balance) }}
            </div>
            <div class="summary-label">Net Balance</div>
        </div>
    </div>

    <!-- Filter Form -->
    <div class="filter-card">
        <h3>ğŸ” Filter Entries</h3>
        <form method="GET" class="filter-grid">
            <div>
                <label>Start Date</label>
                <input type="date" name="start_date" value="{{ start_date or '' }}">
            </div>
            <div>
                <label>End Date</label>
                <input type="date" name="end_date" value="{{ end_date or '' }}">
            </div>
            <button type="submit" class="btn">Apply Filter</button>
            <a href="{{ url_for('expense_history') }}" class="btn btn-secondary">Clear Filter</a>
        </form>
    </div>

    <!-- Table -->
    <div class="table-card">
        <h3>ğŸ“‹ All Entries ({{ expenses|length }})</h3>

        {% if expenses %}
        <div style="overflow-x:auto;">
            <table class="expense-table">
                <thead>
                    <tr>
                        <th>Date</th><th>Type</th><th>Name</th>
                        <th>Description</th><th>Amount</th><th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for expense in expenses %}
                    <tr>
                        <td>{{ expense.date.strftime('%b %d, %Y') }}</td>
                        <td>
                            {% if expense.entry_type == 'income' %}
                            <span class="expense-income">ğŸ’° Income</span>
                            {% else %}
                            <span class="expense-expense">ğŸ’¸ Expense</span>
                            {% endif %}
                        </td>
                        <td>{{ expense.name }}</td>
                        <td>{{ expense.description or '-' }}</td>
                        <td>
                            {% if expense.entry_type == 'income' %}
                            <span class="expense-income">+â‚¹{{ "%.2f"|format(expense.amount) }}</span>
                            {% else %}
                            <span class="expense-expense">-â‚¹{{ "%.2f"|format(expense.amount) }}</span>
                            {% endif %}
                        </td>
                        <td>
                            <button data-id="{{ expense.id }}" class="delete-btn" onclick="confirmDelete(this)">ğŸ—‘ï¸ Delete</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <div>ğŸ“­</div>
            <h3>No Entries Found</h3>
            <a href="{{ url_for('expense') }}" class="btn">â• Add Your First Entry</a>
        </div>
        {% endif %}
    </div>

</div>
<script>
function confirmDelete(button) {
    const expenseId = button.getAttribute("data-id");

    if (confirm("Are you sure you want to delete this entry?")) {
        window.location.href = "/delete-expense/" + expenseId;
    }
}
</script>

{% endblock %}
